<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --light-gray: #f5f7fa;
            --medium-gray: #e1e8ed;
            --dark-gray: #34495e;
            --text-color: #2c3e50;
            --border-radius: 8px;
            --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            --spacing-sm: 8px;
            --spacing-md: 16px;
            --spacing-lg: 24px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--light-gray);
            padding: var(--spacing-md);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-md);
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }

        h1 {
            font-size: 24px;
            color: var(--dark-gray);
        }

        .controls {
            display: flex;
            gap: var(--spacing-md);
            align-items: center;
        }

        input[type="file"] {
            padding: var(--spacing-sm);
            border: 1px solid var(--medium-gray);
            border-radius: var(--border-radius);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #2980b9;
        }

        #export-pdf {
            background-color: var(--secondary-color);
        }

        #export-pdf:hover {
            background-color: #27ae60;
        }

        .category {
            margin-bottom: var(--spacing-lg);
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            overflow: hidden;
        }

        .category-header {
            background-color: var(--dark-gray);
            color: white;
            padding: var(--spacing-md);
            font-size: 20px;
            font-weight: 600;
        }

        .variable {
            padding: var(--spacing-md);
            border-bottom: 1px solid var(--medium-gray);
        }

        .variable:last-child {
            border-bottom: none;
        }

        .variable-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
        }

        .variable-title {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .variable-name {
            font-size: 18px;
            font-weight: 600;
        }

        .tags {
            display: flex;
            gap: var(--spacing-sm);
            margin-top: var(--spacing-sm);
        }

        .tag {
            background-color: var(--medium-gray);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .unit {
            font-size: 14px;
            color: var(--dark-gray);
            margin-left: var(--spacing-sm);
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .checkbox-container input {
            width: 18px;
            height: 18px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: var(--spacing-md);
        }

        th, td {
            padding: var(--spacing-sm);
            text-align: center;
            border: 1px solid var(--medium-gray);
        }

        th {
            background-color: var(--light-gray);
            font-weight: 600;
        }

        .delta-positive {
            color: var(--secondary-color);
            font-weight: 600;
        }

        .delta-negative {
            color: var(--danger-color);
            font-weight: 600;
        }

        .subvariable {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            background-color: var(--light-gray);
            border-radius: var(--border-radius);
        }

        .subvariable-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: var(--spacing-sm);
        }

        .subvariable-name {
            font-weight: 500;
        }

        .notes {
            margin-top: var(--spacing-md);
            padding: var(--spacing-md);
            background-color: #fff9e6;
            border-left: 4px solid var(--warning-color);
            border-radius: var(--border-radius);
        }

        .chart-container {
            margin-top: var(--spacing-md);
            height: 300px;
            position: relative;
        }

        .error-message {
            padding: var(--spacing-md);
            background-color: #ffebee;
            color: var(--danger-color);
            border-radius: var(--border-radius);
            margin-bottom: var(--spacing-md);
            display: none;
        }

        .hidden {
            display: none !important;
        }

        @media print {
            body {
                background-color: white;
                padding: 0;
            }
            
            .controls, button {
                display: none;
            }
            
            .category {
                box-shadow: none;
                border: 1px solid var(--medium-gray);
                break-inside: avoid;
            }
            
            .chart-container {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Analytics Dashboard</h1>
            <div class="controls">
                <input type="file" id="file-upload" accept="application/json">
                <button id="select-all">Select All</button>
                <button id="deselect-all">Deselect All</button>
                <button id="export-pdf">Export to PDF</button>
            </div>
        </header>
        
        <div id="error-message" class="error-message"></div>
        
        <div id="dashboard"></div>
    </div>

    <script>
        // Global variables
        let chartInstances = [];
        let jsonData = null;

        // DOM elements
        const fileUpload = document.getElementById('file-upload');
        const dashboard = document.getElementById('dashboard');
        const errorMessage = document.getElementById('error-message');
        const selectAllBtn = document.getElementById('select-all');
        const deselectAllBtn = document.getElementById('deselect-all');
        const exportPdfBtn = document.getElementById('export-pdf');

        // Event listeners
        fileUpload.addEventListener('change', handleFileUpload);
        selectAllBtn.addEventListener('click', selectAll);
        deselectAllBtn.addEventListener('click', deselectAll);
        exportPdfBtn.addEventListener('click', exportToPDF);

        // File upload handler
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    jsonData = JSON.parse(e.target.result);
                    renderDashboard(jsonData);
                    errorMessage.style.display = 'none';
                } catch (error) {
                    showError('Invalid JSON file: ' + error.message);
                }
            };
            reader.onerror = function() {
                showError('Error reading file');
            };
            reader.readAsText(file);
        }

        // Error display
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
            dashboard.innerHTML = '';
        }

        // Dashboard rendering
        function renderDashboard(data) {
            dashboard.innerHTML = '';
            chartInstances = [];

            // Render each category
            for (const [categoryName, categoryData] of Object.entries(data)) {
                renderCategory(categoryName, categoryData);
            }
        }

        // Render a category
        function renderCategory(categoryName, categoryData) {
            const categoryDiv = document.createElement('div');
            categoryDiv.className = 'category';
            categoryDiv.id = `category-${categoryName}`;

            const headerDiv = document.createElement('div');
            headerDiv.className = 'category-header';
            headerDiv.textContent = categoryName;
            categoryDiv.appendChild(headerDiv);

            // Render each variable in the category
            categoryData.variables.forEach(variable => {
                renderVariable(categoryDiv, variable, categoryName);
            });

            dashboard.appendChild(categoryDiv);
        }

        // Render a variable
        function renderVariable(categoryDiv, variable, categoryName) {
            const variableDiv = document.createElement('div');
            variableDiv.className = 'variable';
            variableDiv.id = `variable-${categoryName}-${variable.name.trim().replace(/\s+/g, '-')}`;

            // Variable header
            const headerDiv = document.createElement('div');
            headerDiv.className = 'variable-header';

            const titleDiv = document.createElement('div');
            titleDiv.className = 'variable-title';

            const nameSpan = document.createElement('span');
            nameSpan.className = 'variable-name';
            nameSpan.textContent = variable.name.trim();

            const unitSpan = document.createElement('span');
            unitSpan.className = 'unit';
            unitSpan.textContent = variable.unit ? `(${variable.unit})` : '';

            titleDiv.appendChild(nameSpan);
            titleDiv.appendChild(unitSpan);

            // Tags
            if (variable.tags && variable.tags.length > 0) {
                const tagsDiv = document.createElement('div');
                tagsDiv.className = 'tags';
                variable.tags.forEach(tag => {
                    const tagSpan = document.createElement('span');
                    tagSpan.className = 'tag';
                    tagSpan.textContent = tag;
                    tagsDiv.appendChild(tagSpan);
                });
                titleDiv.appendChild(tagsDiv);
            }

            headerDiv.appendChild(titleDiv);

            // Checkbox
            const checkboxDiv = document.createElement('div');
            checkboxDiv.className = 'checkbox-container';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = `checkbox-${categoryName}-${variable.name.trim().replace(/\s+/g, '-')}`;
            checkbox.checked = true;

            const checkboxLabel = document.createElement('label');
            checkboxLabel.setAttribute('for', checkbox.id);
            checkboxLabel.textContent = 'Include in PDF';

            checkboxDiv.appendChild(checkbox);
            checkboxDiv.appendChild(checkboxLabel);
            headerDiv.appendChild(checkboxDiv);

            variableDiv.appendChild(headerDiv);

            // Data table
            const table = createDataTable(variable.data, variable.unit);
            variableDiv.appendChild(table);

            // Subvariables
            if (variable.subVariables && variable.subVariables.length > 0) {
                variable.subVariables.forEach(subVariable => {
                    renderSubVariable(variableDiv, subVariable, categoryName, variable.name);
                });
            }

            // Notes
            if (variable.notes && variable.notes.trim() !== '') {
                const notesDiv = document.createElement('div');
                notesDiv.className = 'notes';
                notesDiv.textContent = variable.notes.trim();
                variableDiv.appendChild(notesDiv);
            }

            // Chart
            const chartContainer = document.createElement('div');
            chartContainer.className = 'chart-container';
            const chartId = `chart-${categoryName}-${variable.name.trim().replace(/\s+/g, '-')}`;
            chartContainer.id = chartId;
            variableDiv.appendChild(chartContainer);

            categoryDiv.appendChild(variableDiv);

            // Render chart after DOM is updated
            setTimeout(() => {
                renderChart(chartId, variable, categoryName);
            }, 100);
        }

        // Render a subvariable
        function renderSubVariable(parentDiv, subVariable, categoryName, parentVariableName) {
            const subVariableDiv = document.createElement('div');
            subVariableDiv.className = 'subvariable';

            // Subvariable header
            const headerDiv = document.createElement('div');
            headerDiv.className = 'subvariable-header';

            const nameSpan = document.createElement('span');
            nameSpan.className = 'subvariable-name';
            nameSpan.textContent = subVariable.name;

            headerDiv.appendChild(nameSpan);

            // Checkbox
            const checkboxDiv = document.createElement('div');
            checkboxDiv.className = 'checkbox-container';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.id = `checkbox-${categoryName}-${parentVariableName.trim().replace(/\s+/g, '-')}-${subVariable.name.trim().replace(/\s+/g, '-')}`;
            checkbox.checked = true;

            const checkboxLabel = document.createElement('label');
            checkboxLabel.setAttribute('for', checkbox.id);
            checkboxLabel.textContent = 'Include in PDF';

            checkboxDiv.appendChild(checkbox);
            checkboxDiv.appendChild(checkboxLabel);
            headerDiv.appendChild(checkboxDiv);

            subVariableDiv.appendChild(headerDiv);

            // Data table
            const table = createDataTable(subVariable.data, '');
            subVariableDiv.appendChild(table);

            parentDiv.appendChild(subVariableDiv);
        }

        // Create data table with deltas
        function createDataTable(data, unit) {
            const weeks = Object.keys(data);
            const values = Object.values(data);
            const deltas = calculateDeltas(values);

            const table = document.createElement('table');
            
            // Header row
            const headerRow = document.createElement('tr');
            const weekHeader = document.createElement('th');
            weekHeader.textContent = 'Week';
            headerRow.appendChild(weekHeader);
            
            weeks.forEach(week => {
                const th = document.createElement('th');
                th.textContent = week;
                headerRow.appendChild(th);
            });
            table.appendChild(headerRow);
            
            // Value row
            const valueRow = document.createElement('tr');
            const valueLabel = document.createElement('td');
            valueLabel.textContent = 'Value';
            valueRow.appendChild(valueLabel);
            
            values.forEach(value => {
                const td = document.createElement('td');
                td.textContent = value !== null ? value + (unit ? ` ${unit}` : '') : '–';
                valueRow.appendChild(td);
            });
            table.appendChild(valueRow);
            
            // Delta row
            const deltaRow = document.createElement('tr');
            const deltaLabel = document.createElement('td');
            deltaLabel.textContent = 'Delta';
            deltaRow.appendChild(deltaLabel);
            
            deltas.forEach(delta => {
                const td = document.createElement('td');
                if (delta !== null) {
                    td.textContent = (delta > 0 ? '+' : '') + delta;
                    td.className = delta >= 0 ? 'delta-positive' : 'delta-negative';
                } else {
                    td.textContent = '–';
                }
                deltaRow.appendChild(td);
            });
            table.appendChild(deltaRow);
            
            return table;
        }

        // Calculate deltas between consecutive non-null values
        function calculateDeltas(values) {
            const deltas = [];
            let prevValue = null;
            
            for (let i = 0; i < values.length; i++) {
                const currentValue = values[i];
                
                if (currentValue === null) {
                    deltas.push(null);
                } else if (prevValue === null) {
                    deltas.push(null);
                    prevValue = currentValue;
                } else {
                    deltas.push(currentValue - prevValue);
                    prevValue = currentValue;
                }
            }
            
            return deltas;
        }

        // Render chart for a variable
        function renderChart(chartId, variable, categoryName) {
            const ctx = document.getElementById(chartId).getContext('2d');
            const weeks = Object.keys(variable.data);
            
            // Prepare datasets
            const datasets = [];
            
            // Main variable dataset
            const mainData = Object.values(variable.data);
            datasets.push({
                label: variable.name.trim(),
                data: mainData,
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                tension: 0.1,
                fill: true
            });
            
            // Subvariable datasets
            if (variable.subVariables && variable.subVariables.length > 0) {
                const colors = ['#2ecc71', '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c'];
                
                variable.subVariables.forEach((subVar, index) => {
                    datasets.push({
                        label: subVar.name,
                        data: Object.values(subVar.data),
                        borderColor: colors[index % colors.length],
                        backgroundColor: 'transparent',
                        tension: 0.1
                    });
                });
            }
            
            // Create chart
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeks,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `${variable.name.trim()} - ${categoryName}`
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
            
            chartInstances.push(chart);
        }

        // Select all checkboxes
        function selectAll() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = true;
            });
        }

        // Deselect all checkboxes
        function deselectAll() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
        }

        // Export to PDF
        async function exportToPDF() {
            if (!jsonData) {
                showError('No data loaded. Please upload a JSON file first.');
                return;
            }

            // Create a temporary container for PDF content
            const pdfContainer = document.createElement('div');
            pdfContainer.id = 'pdf-container';
            pdfContainer.style.width = '1123px'; // A4 landscape width in pixels
            pdfContainer.style.padding = '20px';
            pdfContainer.style.backgroundColor = 'white';
            
            // Add title
            const title = document.createElement('h1');
            title.textContent = 'Analytics Report';
            title.style.textAlign = 'center';
            title.style.marginBottom = '30px';
            pdfContainer.appendChild(title);
            
            // Process each category
            for (const [categoryName, categoryData] of Object.entries(jsonData)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                categoryDiv.style.marginBottom = '30px';
                categoryDiv.style.breakInside = 'avoid';
                
                const headerDiv = document.createElement('div');
                headerDiv.className = 'category-header';
                headerDiv.textContent = categoryName;
                categoryDiv.appendChild(headerDiv);
                
                // Process each variable in the category
                categoryData.variables.forEach(variable => {
                    const variableCheckboxId = `checkbox-${categoryName}-${variable.name.trim().replace(/\s+/g, '-')}`;
                    const variableCheckbox = document.getElementById(variableCheckboxId);
                    
                    if (variableCheckbox && variableCheckbox.checked) {
                        const variableDiv = document.createElement('div');
                        variableDiv.className = 'variable';
                        
                        // Variable header
                        const variableHeader = document.createElement('div');
                        variableHeader.className = 'variable-header';
                        
                        const titleDiv = document.createElement('div');
                        titleDiv.className = 'variable-title';
                        
                        const nameSpan = document.createElement('span');
                        nameSpan.className = 'variable-name';
                        nameSpan.textContent = variable.name.trim();
                        
                        const unitSpan = document.createElement('span');
                        unitSpan.className = 'unit';
                        unitSpan.textContent = variable.unit ? `(${variable.unit})` : '';
                        
                        titleDiv.appendChild(nameSpan);
                        titleDiv.appendChild(unitSpan);
                        
                        // Tags
                        if (variable.tags && variable.tags.length > 0) {
                            const tagsDiv = document.createElement('div');
                            tagsDiv.className = 'tags';
                            variable.tags.forEach(tag => {
                                const tagSpan = document.createElement('span');
                                tagSpan.className = 'tag';
                                tagSpan.textContent = tag;
                                tagsDiv.appendChild(tagSpan);
                            });
                            titleDiv.appendChild(tagsDiv);
                        }
                        
                        variableHeader.appendChild(titleDiv);
                        variableDiv.appendChild(variableHeader);
                        
                        // Data table
                        const table = createDataTable(variable.data, variable.unit);
                        variableDiv.appendChild(table);
                        
                        // Subvariables
                        if (variable.subVariables && variable.subVariables.length > 0) {
                            variable.subVariables.forEach(subVariable => {
                                const subVariableCheckboxId = `checkbox-${categoryName}-${variable.name.trim().replace(/\s+/g, '-')}-${subVariable.name.trim().replace(/\s+/g, '-')}`;
                                const subVariableCheckbox = document.getElementById(subVariableCheckboxId);
                                
                                if (subVariableCheckbox && subVariableCheckbox.checked) {
                                    const subVariableDiv = document.createElement('div');
                                    subVariableDiv.className = 'subvariable';
                                    
                                    const subHeaderDiv = document.createElement('div');
                                    subHeaderDiv.className = 'subvariable-header';
                                    
                                    const subNameSpan = document.createElement('span');
                                    subNameSpan.className = 'subvariable-name';
                                    subNameSpan.textContent = subVariable.name;
                                    
                                    subHeaderDiv.appendChild(subNameSpan);
                                    subVariableDiv.appendChild(subHeaderDiv);
                                    
                                    const subTable = createDataTable(subVariable.data, '');
                                    subVariableDiv.appendChild(subTable);
                                    
                                    variableDiv.appendChild(subVariableDiv);
                                }
                            });
                        }
                        
                        // Notes
                        if (variable.notes && variable.notes.trim() !== '') {
                            const notesDiv = document.createElement('div');
                            notesDiv.className = 'notes';
                            notesDiv.textContent = variable.notes.trim();
                            variableDiv.appendChild(notesDiv);
                        }
                        
                        // Chart
                        const chartContainer = document.createElement('div');
                        chartContainer.className = 'chart-container';
                        chartContainer.style.height = '200px';
                        
                        // Create a canvas for the chart
                        const canvas = document.createElement('canvas');
                        chartContainer.appendChild(canvas);
                        variableDiv.appendChild(chartContainer);
                        
                        categoryDiv.appendChild(variableDiv);
                        
                        // Render chart to the canvas
                        setTimeout(() => {
                            renderChartToCanvas(canvas, variable, categoryName);
                        }, 100);
                    }
                });
                
                if (categoryDiv.children.length > 1) { // More than just the header
                    pdfContainer.appendChild(categoryDiv);
                }
            }
            
            // Add to document temporarily
            document.body.appendChild(pdfContainer);
            
            try {
                // Generate PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('landscape', 'px', 'a4');
                
                // Use html2canvas to capture the content
                const canvas = await html2canvas(pdfContainer, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    logging: false
                });
                
                const imgData = canvas.toDataURL('image/png');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                
                // Calculate image dimensions to fit the page
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                const imgX = (pdfWidth - imgWidth * ratio) / 2;
                const imgY = 30;
                
                pdf.addImage(imgData, 'PNG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
                pdf.save('analytics-report.pdf');
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                showError('Error generating PDF: ' + error.message);
            } finally {
                // Clean up
                document.body.removeChild(pdfContainer);
            }
        }

        // Render chart to a specific canvas (for PDF)
        function renderChartToCanvas(canvas, variable, categoryName) {
            const ctx = canvas.getContext('2d');
            const weeks = Object.keys(variable.data);
            
            // Prepare datasets
            const datasets = [];
            
            // Main variable dataset
            const mainData = Object.values(variable.data);
            datasets.push({
                label: variable.name.trim(),
                data: mainData,
                borderColor: '#3498db',
                backgroundColor: 'rgba(52, 152, 219, 0.1)',
                tension: 0.1,
                fill: true
            });
            
            // Subvariable datasets (only those selected)
            if (variable.subVariables && variable.subVariables.length > 0) {
                const colors = ['#2ecc71', '#e74c3c', '#f39c12', '#9b59b6', '#1abc9c'];
                
                variable.subVariables.forEach((subVar, index) => {
                    const subVariableCheckboxId = `checkbox-${categoryName}-${variable.name.trim().replace(/\s+/g, '-')}-${subVar.name.trim().replace(/\s+/g, '-')}`;
                    const subVariableCheckbox = document.getElementById(subVariableCheckboxId);
                    
                    if (subVariableCheckbox && subVariableCheckbox.checked) {
                        datasets.push({
                            label: subVar.name,
                            data: Object.values(subVar.data),
                            borderColor: colors[index % colors.length],
                            backgroundColor: 'transparent',
                            tension: 0.1
                        });
                    }
                });
            }
            
            // Create chart
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: weeks,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `${variable.name.trim()} - ${categoryName}`
                        },
                        legend: {
                            display: datasets.length > 1
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
